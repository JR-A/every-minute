<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper   
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"   
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">  
<mapper namespace="kr.spring.member.dao.MemberMapper"> <!-- interface 전체 경로까지 모두 명시해야 자동매핑  -->
<select id="myFreeselectList" parameterType="map" resultType="FreeBoardVO">
		SELECT * FROM (SELECT a.*, rownum rnum FROM (SELECT * FROM  freeboard b JOIN member m ON b.mem_num=m.mem_num 
		<where><!-- 조건에 만족하는것이 하나라도 있어야 WHERE절이 생김 (동적SQL: 상황에 따라 실행되는 부분적인 SQL) -->
			<if test="keyword != '' and keyfield == 'title'"> <!-- 타이틀 -->
				b.title LIKE '%' || #{keyword} || '%'
			</if>
			<if test="keyword != '' and keyfield == 'id'"> <!-- 아이디 -->
				m.id LIKE '%' || #{keyword} || '%'
			</if>
			<if test="keyword != '' and keyfield == 'content'"> <!-- 내용 -->
				b.content LIKE '%' || #{keyword} || '%'
			</if>
			<if test="keyword != '' and keyfield == 'all'"> <!-- 전체 -->
				b.title LIKE '%' || #{keyword} || '%' or
				m.id LIKE '%' || #{keyword} || '%' or
				b.content LIKE '%' || #{keyword} || '%' 
			</if>
		</where>
		 and m.mem_num= #{mem_num} ORDER BY b.post_num DESC)a)
		<![CDATA[
		WHERE rnum >= #{start} AND rnum <= #{end}
		]]>
	</select>

	<select id="myFreeselectRowCount" parameterType="map" resultType="integer">
		SELECT COUNT(*) FROM freeboard b JOIN member m ON b.mem_num = m.mem_num WHERE m.mem_num= #{mem_num}
	</select>


<select id="myInfoselectList" parameterType="map" resultType="InfoBoardVO">
		SELECT * FROM (SELECT a.*, rownum rnum FROM (SELECT * FROM  infoboard b JOIN member m ON b.mem_num=m.mem_num 
		<where><!-- 조건에 만족하는것이 하나라도 있어야 WHERE절이 생김 (동적SQL: 상황에 따라 실행되는 부분적인 SQL) -->
			<if test="keyword != '' and keyfield == 'title'"> <!-- 타이틀 -->
				b.title LIKE '%' || #{keyword} || '%'
			</if>
			<if test="keyword != '' and keyfield == 'id'"> <!-- 아이디 -->
				m.id LIKE '%' || #{keyword} || '%'
			</if>
			<if test="keyword != '' and keyfield == 'content'"> <!-- 내용 -->
				b.content LIKE '%' || #{keyword} || '%'
			</if>
			<if test="keyword != '' and keyfield == 'all'"> <!-- 전체 -->
				b.title LIKE '%' || #{keyword} || '%' or
				m.id LIKE '%' || #{keyword} || '%' or
				b.content LIKE '%' || #{keyword} || '%' 
			</if>
		</where>
		and m.mem_num= #{mem_num} ORDER BY b.post_num DESC)a)
		<![CDATA[
		WHERE rnum >= #{start} AND rnum <= #{end}
		]]>
	</select>
	
	<select id="myInfoselectRowCount" parameterType="map" resultType="integer">
		SELECT COUNT(*) FROM infoboard b JOIN member m ON b.mem_num = m.mem_num WHERE m.mem_num= #{mem_num}
	</select>

	 <!-- interface 전체 경로까지 모두 명시해야 자동매핑  -->
	
	<!-- 게시판 정보 -->
	<select id="selectBoardInfo" parameterType="int" resultType="customBoardVO">
		SELECT * FROM customBoard WHERE board_num = #{board_num}
	</select>
	
	<!-- 게시글 목록 --> 
	<select id="myCustomselectPostList" parameterType="map" resultType="customPostVO"> <!-- 쿼리 실행 결과를  customBoardVO에  담는다-->
	SELECT * FROM
		(SELECT search.* FROM 
			(SELECT board.*, rownum rnum FROM
				(SELECT * FROM 
					CustomPost cust_p JOIN Member m 
						ON cust_p.mem_num = m.mem_num 
					WHERE board_num = #{board_num} and m.mem_num=#{mem_num}
						ORDER BY cust_p.post_num DESC 
				) board) 
				<where>
					<!-- ***** 해시태그 keyfield 추가해야 함 ***** -->
					
					<if test="keyword != '' and keyfield == 'content'">
						cust_p.content LIKE '%' || #{keyword} || '%')
					</if>
					<if test="keyword != '' and keyfield == 'all'"> 
						cust_p.title LIKE '%' || #{keyword} || '%' or cust_p.content LIKE '%' || #{keyword} || '%')
					</if>
				</where>
			search)
	<![CDATA[
		WHERE rnum>=#{start} AND rnum <= #{end}
	]]>
	
	</select>
		<select id="myCustomselectRowCount" parameterType="map" resultType="integer">
		SELECT
			COUNT(*)
		FROM CustomPost cust_p JOIN Member m
		ON cust_p.mem_num = m.mem_num where board_num = #{board_num} and m.mem_num=#{mem_num}
	</select>
</mapper>